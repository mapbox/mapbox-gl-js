'use strict';

require('flow-remove-types/register');
const tap = module.exports = require('tap');
const sinon = require('sinon');

tap.Test.prototype.addAssert('equalWithPrecision', 3, assertEqualWithPrecision);

function assertEqualWithPrecision(expected, actual, multiplier, message, extra) {
    message = message || `should be equal to within ${multiplier}`;
    const expectedRounded = Math.round(expected / multiplier) * multiplier;
    const actualRounded = Math.round(actual / multiplier) * multiplier;

    return this.equal(expectedRounded, actualRounded, message, extra);
}

tap.beforeEach(function (done) {
    this.sandbox = sinon.sandbox.create({
        injectInto: this,
        properties: ['spy', 'stub', 'mock']
    });
    done();
});

tap.afterEach(function (done) {
    this.sandbox.restore();
    done();
});
