--- 
layout: example 
category: example 
title: Join client data to vector tiles 
description: Use data-driven styles to join client data to vector tiles
tags: 
  - sources 
---

<div id='map'></div>
<script>
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/light-v9',
    center: [-99.9, 41.5],
    zoom: 1
});

// Generate client data to join to vector tiles
// Key is the property to join, value is the measure to style on
// EX: {"01" : 27, "02" : 89}
var maxValue = 100;
var data = {};
for (var i = 1; i <= 78; i++) {
    var id = (i < 10) ? ("0" + i) : i;
    var randomNum = Math.floor((Math.random() * maxValue) + 1);
    data[id] = randomNum;
}

// Get the vector data to join
var mapId = 'mapbox.us_census_states_2015';
var layerName = 'states';
var vtMatchProp = 'STATE_ID';

map.on('load', function() {

    // Add source for state polygons hosted on Mapbox
    map.addSource('states', {
        type: 'vector',
        url: 'mapbox://' + mapId
    });

    // First value is the default, used where the is no data
    var stops = [["0", "rgba(0,0,0,0)"]];

    // Calculate color based on the data value
    for (var key in data) {
        var green = ((data[key] / maxValue) * 255);
        var color = "rgba(" + 0 + ", " + green + ", " + 0 + ", 1)";
        stops.push([key, color]);
    }

    // Add layer from the vector tile source with data-driven style
    map.addLayer({
        "id": "states-join",
        "type": "fill",
        "source": 'states',
        "source-layer": layerName,
        "paint": {
            "fill-color": {
                property: vtMatchProp,
                type: "categorical",
                stops: stops
            }
        }
    });
});
</script>
